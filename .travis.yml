sudo: required
language: scala
scala:
  - 2.12.12
services:
  - docker
jdk:
  - openjdk8
before_cache:
  - find $HOME/.ivy2 -name "ivydata-*.properties" -print -delete
  - find $HOME/.sbt  -name "*.lock"               -print -delete
cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.sbt
    - $HOME/.custom-cache
script:
  - sbt -jvm-opts .jvmopts-travis clean coverage fixCheck test coverageReport coverageAggregate
after_success:
  - bash <(curl -s https://codecov.io/bash)
  - >
    test "${TRAVIS_PULL_REQUEST}" = 'false' &&
    test "${TRAVIS_REPO_SLUG}" = 'radicalbit/NSDb' &&
    test "${TRAVIS_JDK_VERSION}" = 'oraclejdk8' &&
    sh "$TRAVIS_BUILD_DIR/travis-credentials.sh"
  - |
    if [[[ ${TRAVIS_BRANCH} -eq "master" || ${TRAVIS_BRANCH} = branch-* ] && ${TRAVIS_EVENT_TYPE} = "push" ] || ${TRAVIS_TAG} -ne "" ]; then
      sbt publish
      docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
      sbt docker:publish;
    fi
